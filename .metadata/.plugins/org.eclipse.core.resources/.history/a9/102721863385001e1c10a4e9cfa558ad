package com.shoplaptop.dao;

import java.security.cert.TrustAnchor;
import java.sql.ResultSet;
import java.util.ArrayList;
import java.util.List;

import com.shoplaptop.entity.HoaDon;
import com.shoplaptop.utils.XJdbc;

public class HoaDonDAO implements ShopLaptop365DAO<HoaDon, String>{
	String SelectALL = "SELECT dbo.HoaDon.ID, dbo.HoaDon.MaHD, dbo.HoaDon.MaKH, dbo.Serial.SerialNumber,dbo.Laptop.TenLaptop,\r\n"
			+ "		dbo.BienThe.GiaBan,HinhThucVanChuyen.HinhThuc AS 'HinhThucVanChuyen', HinhThucThanhToan.HinhThuc AS 'HinhThucThanhToan', dbo.HoaDon.PhieuGiamGia,\r\n"
			+ "		dbo.HoaDon.DotGiamGia,dbo.HoaDon.MaNV,dbo.HoaDon.NgayTao, dbo.HoaDon.TongTien\r\n"
			+ "FROM dbo.HoaDon JOIN dbo.CTHoaDon ON CTHoaDon.MaHD = HoaDon.MaHD\r\n"
			+ "	JOIN dbo.Serial ON Serial.ID = CTHoaDon.ID_Serial\r\n"
			+ "	JOIN dbo.BienThe ON BienThe.ID = Serial.ID_BienThe\r\n"
			+ "	JOIN dbo.Laptop ON Laptop.ID = BienThe.ID_Laptop\r\n"
			+ "	JOIN dbo.HinhThucVanChuyen ON HinhThucVanChuyen.ID = HoaDon.HinhThucVanChuyen\r\n"
			+ "	JOIN dbo.HinhThucThanhToan ON HinhThucThanhToan.ID = HoaDon.HinhThucThanhToan";
	
	String SelectByMaHD = "SELECT dbo.HoaDon.ID,  dbo.HoaDon.MaHD, dbo.HoaDon.MaKH, dbo.Serial.SerialNumber,dbo.Laptop.TenLaptop,\r\n"
			+ "		dbo.BienThe.GiaBan,HinhThucVanChuyen.HinhThuc AS 'HinhThucVanChuyen', HinhThucThanhToan.HinhThuc AS 'HinhThucThanhToan', dbo.HoaDon.PhieuGiamGia,\r\n"
			+ "		dbo.HoaDon.DotGiamGia,dbo.HoaDon.MaNV,dbo.HoaDon.NgayTao, dbo.HoaDon.TongTien\r\n"
			+ "FROM dbo.HoaDon JOIN dbo.CTHoaDon ON CTHoaDon.MaHD = HoaDon.MaHD where HoaDon.MaHD = ?"
			+ "	JOIN dbo.Serial ON Serial.ID = CTHoaDon.ID_Serial\r\n"
			+ "	JOIN dbo.BienThe ON BienThe.ID = Serial.ID_BienThe\r\n"
			+ "	JOIN dbo.Laptop ON Laptop.ID = BienThe.ID_Laptop\r\n"
			+ "	JOIN dbo.HinhThucVanChuyen ON HinhThucVanChuyen.ID = HoaDon.HinhThucVanChuyen\r\n"
			+ "	JOIN dbo.HinhThucThanhToan ON HinhThucThanhToan.ID = HoaDon.HinhThucThanhToan";
	
	String selectHD = "SELECT MaHD, MaKH, MaNV FROM dbo.HoaDon \r\n";
	String selectHD1 = "SELECT MaHD, MaKH, MaNV FROM dbo.HoaDon WHERE MaHD = ?"; 
	
	@Override
	public String insert(HoaDon entity) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String update(HoaDon entity) {
		// TODO Auto-generated method stub
		return null;
	}

	@Override
	public String delete(String id) {
		// TODO Auto-generated method stub
		return null;
	}


	public HoaDon selectById(String select, String MaHD,String SerialNumber) {
		
		return this.SelectSPMua(select, MaHD,SerialNumber).get(0);
	}
	
	String SelectSPMUA = "SELECT dbo.Serial.SerialNumber , dbo.BienThe.GiaBan , dbo.Laptop.TenLaptop \r\n"
			+ "			FROM dbo.HoaDon JOIN dbo.CTHoaDon ON CTHoaDon.MaHD = HoaDon.MaHD \r\n"
			+ "			JOIN dbo.Serial ON Serial.ID = CTHoaDon.ID_Serial \r\n"
			+ "			JOIN dbo.BienThe ON BienThe.ID = Serial.ID_BienThe\r\n"
			+ "			JOIN dbo.Laptop ON Laptop.ID = BienThe.ID_Laptop\r\n"
			+ "		WHERE HoaDon.MaHD = ?";
	
	public List<HoaDon> selectAllSPDaMua(String MaHD) {
		return this.SelectSPMua(SelectSPMUA, MaHD);
	}
	
	public List<HoaDon> SelectSPMua(String sql, Object... args){
		List<HoaDon> list = new ArrayList<HoaDon>();
		try {
			ResultSet rs = XJdbc.query(sql, args);
			while (rs.next()) {
				HoaDon hoaDon = new HoaDon();
				hoaDon.setSerialNumber(rs.getString("SerialNumber"));
				hoaDon.setTenLap(rs.getString("TenLaptop"));
				hoaDon.setGiaBan(rs.getDouble("GiaBan"));
				list.add(hoaDon);
			}
			rs.getStatement().getConnection().close();
			return list;
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
	}

	@Override
	public List<HoaDon> selectAll() {
		return this.selectBySQL(SelectALL);
	}
	
	public List<HoaDon> selectHD() {
		return selectHDSQL(selectHD);
	}
	
	public List<HoaDon> selectHDSQL(String sql, Object... args) {
		List<HoaDon> list = new ArrayList<HoaDon>();
		try {
			ResultSet rs = XJdbc.query(sql, args);
			while (rs.next()) {
				HoaDon hoaDon = new HoaDon();
				hoaDon.setMaHD(rs.getString("MaHD"));
				hoaDon.setMaKH(rs.getString("MaKH"));
				hoaDon.setMaNV(rs.getString("MaNV"));
				list.add(hoaDon);
			}
			rs.getStatement().getConnection().close();
			return list;
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
	}
	

	@Override
	public List<HoaDon> selectBySQL(String sql, Object... args) {
		List<HoaDon> list = new ArrayList<HoaDon>();
		try {
			ResultSet rs = XJdbc.query(sql, args);
			while (rs.next()) {
				HoaDon hoaDon = new HoaDon();
				hoaDon.setID(rs.getInt("ID"));
				hoaDon.setMaHD(rs.getString("MaHD"));
				hoaDon.setMaKH(rs.getString("MaKH"));
				hoaDon.setSerialNumber(rs.getString("SerialNumber"));
				hoaDon.setTenLap(rs.getString("TenLaptop"));
				hoaDon.setGiaBan(rs.getDouble("GiaBan"));
				hoaDon.setHinhThucVanChuyen(rs.getString("HinhThucVanChuyen"));
				hoaDon.setHinhThucThanhToan(rs.getString("HinhThucThanhToan"));
				hoaDon.setPhieuGiamGia(rs.getString("PhieuGiamGia"));
				hoaDon.setDotGiamGia(rs.getString("DotGiamGia"));
				hoaDon.setDotGiamGia(rs.getString("MaNV"));
				hoaDon.setNgayTao(rs.getDate("NgayTao"));
				hoaDon.setTongTien(rs.getDouble("TongTien"));
				list.add(hoaDon);
			}
			rs.getStatement().getConnection().close();
			return list;
		} catch (Exception e) {
			throw new RuntimeException(e);
		}
		
	}

	
	public HoaDon selectByMaHD(String id) {
		
		return selectHDSQL(selectHD1, id).get(0);
	}

	@Override
	public HoaDon selectById(String id) {
		// TODO Auto-generated method stub
		return null;
	}
	
}
